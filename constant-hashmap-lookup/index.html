<!DOCTYPE html>
<html lang="en">

<head>
    <title>Making an immutable hashmap constant | Bite‚Äësized Rust learning, powered by Pybites</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="robots" content="noodp"/>

    <link rel="stylesheet" href="https://rsbit.es/style.css">
    <link rel="stylesheet" href="https://rsbit.es/color/blue.css">

    <link rel="stylesheet" href="https://rsbit.es/font-hack-subset.css">

    <meta name="description" content="">

    <meta property="og:description" content="">
    <meta property="og:title" content="Making an immutable hashmap constant | Bite‚Äësized Rust learning, powered by Pybites">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://rsbit.es/constant-hashmap-lookup/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="">
    <meta name="twitter:title" content="Making an immutable hashmap constant | Bite‚Äësized Rust learning, powered by Pybites">
    <meta property="twitter:domain" content="rsbit.es">
    <meta property="twitter:url" content="https://rsbit.es/constant-hashmap-lookup/">

            
        <link rel="alternate" type="application/atom+xml" title="RSS" href="https://rsbit.es/atom.xml">
    
    </head>

<body class="">
<div class="container">
    
    <header class="header">
        <div class="header__inner">
            <div class="header__logo">
                    
                <a href="/" style="text-decoration: none;">
                    <div class="logo">
                      
                            Bite-sized Rust
                        
                    </div>
                </a>
            </div>
        </div>

        
        
                <nav class="menu">
            <ul class="menu__inner">
                <li class="active"><a href="https://rsbit.es">Home</a></li>
            
                <li><a href="https://rsbit.es/pages/archive">Archive</a></li>
            
                <li><a href="https://rustplatform.com" target="_blank" rel="noopener noreferrer">Excercises</a></li>
            
                <li><a href="https://rsbit.es/pages/search">Search</a></li>
            
                <li><a href="https://rsbit.es/pages/about">About</a></li>
            
                <li><a href="https://github.com/bbelderbos" target="_blank" rel="noopener noreferrer">GitHub</a></li>
            </ul>
        </nav>
    
    
        
    </header>
    

    <div class="content">
        
    <div class="post">
        
    <h1 class="post-title"><a href="https://rsbit.es/constant-hashmap-lookup/">Making an immutable hashmap constant</a></h1>
    <div class="post-meta-inline">
        
    <span class="post-date">
            2024-06-23
        </span>

    </div>

    

        <div class="post-content">
            <p>The other day I needed an dictionary / HashMap to look up <a href="https://github.com/bbelderbos/pybites-search/issues/5">abbreviated content types</a>.</p>
<h2 id="constant-dictionary-hashmap">Constant dictionary / hashmap</h2>
<p>I wondered how to make it constant and if I could use the nice Python <code>dict.get(key, key)</code> idiom to return the key itself if it is not found in the dictionary.</p>
<p>I found the <code>phf</code> crate, which is a perfect fit for this it seems. And it supports the <code>get</code> method and the <code>unwrap_or</code> method to provide a default value if the key is not found.</p>
<p>Another option is <code>lazy_static</code> but I read that <code>phf</code> enforces immutability more strictly by design and that it can provide more efficient access patterns due to its compile-time optimizations (the data is embedded in the binary).</p>
<h2 id="phf-example"><code>phf</code> example</h2>
<p>I added this code (<a href="https://github.com/bbelderbos/pybites-search/commit/6fb8b032f36c0564e843a0072ee0960ac8f1543f">commit</a>):</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">use </span><span>phf::phf_map;
</span><span>
</span><span style="color:#b48ead;">static </span><span style="color:#d08770;">CATEGORY_MAPPING</span><span>: phf::Map&lt;&amp;</span><span style="color:#b48ead;">&#39;static str</span><span>, &amp;</span><span style="color:#b48ead;">&#39;static str</span><span>&gt; = phf_map! {
</span><span>    &quot;</span><span style="color:#a3be8c;">a</span><span>&quot; =&gt; &quot;</span><span style="color:#a3be8c;">article</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">b</span><span>&quot; =&gt; &quot;</span><span style="color:#a3be8c;">bite</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">p</span><span>&quot; =&gt; &quot;</span><span style="color:#a3be8c;">podcast</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">v</span><span>&quot; =&gt; &quot;</span><span style="color:#a3be8c;">video</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">t</span><span>&quot; =&gt; &quot;</span><span style="color:#a3be8c;">tip</span><span>&quot;,
</span><span>};
</span><span>
</span><span>
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span>    </span><span style="color:#b48ead;">for</span><span> ct in &amp;[&quot;</span><span style="color:#a3be8c;">a</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">b</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">p</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">v</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">t</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">not found</span><span>&quot;] {
</span><span>        </span><span style="color:#b48ead;">let</span><span> value = </span><span style="color:#d08770;">CATEGORY_MAPPING</span><span>.</span><span style="color:#96b5b4;">get</span><span>(ct).</span><span style="color:#96b5b4;">unwrap_or</span><span>(&amp;ct).</span><span style="color:#96b5b4;">to_string</span><span>();
</span><span>        println!(&quot;</span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;"> -&gt; </span><span style="color:#d08770;">{}</span><span>&quot;, ct, value);
</span><span>    }
</span><span>}
</span></code></pre>
<p>This prints:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">a</span><span> -&gt; article
</span><span style="color:#bf616a;">b</span><span> -&gt; bite
</span><span style="color:#bf616a;">p</span><span> -&gt; podcast
</span><span style="color:#bf616a;">v</span><span> -&gt; video
</span><span style="color:#bf616a;">t</span><span> -&gt; tip
</span><span style="color:#bf616a;">not</span><span> found -&gt; not found
</span></code></pre>
<ul>
<li>The <code>phf_map!</code> macro creates a constant hashmap.</li>
<li>The <code>CATEGORY_MAPPING</code> is a static variable that holds the hashmap.</li>
<li>The <code>get</code> method is used to lookup the key in the hashmap.</li>
<li>The <code>unwrap_or</code> method is used to provide a default value if the key is not found.</li>
<li>The <code>to_string</code> method is used to convert the value to a string.</li>
</ul>
<p>Note that you need to enable the <code>macros</code> feature in your <code>Cargo.toml</code> file:</p>
<h2 id="configuring-phf">Configuring <code>phf</code></h2>
<pre data-lang="toml" style="background-color:#2b303b;color:#c0c5ce;" class="language-toml "><code class="language-toml" data-lang="toml"><span style="color:#bf616a;">phf </span><span>= { </span><span style="color:#bf616a;">version </span><span>= &quot;</span><span style="color:#a3be8c;">0.11.2</span><span>&quot;, </span><span style="color:#bf616a;">features </span><span>= [&quot;</span><span style="color:#a3be8c;">macros</span><span>&quot;] }
</span></code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>With <code>phf</code> you can create a constant hashmap in an efficient way. It is a good fit for cases where you need to look up values by key and you want to enforce immutability. üí°</p>
<p>And with that you can now use Pybites Search with both <code>-c a</code> and <code>-c article</code>, <code>-c b</code> and <code>-c bite</code>, etc. üéâ üöÄ</p>

        </div>

        
        <div class="pagination">
            <div class="pagination__title">
                <span class="pagination__title-h">Thanks for reading! Reach out to me on X | Fosstodon | LinkedIn: @bbelderbos</span>
                <hr />
            </div>
            <div class="pagination__buttons">
                    <span class="button previous">
                        <a href="https://rsbit.es/linting-with-clippy/">
                            <span class="button__icon">‚Üê</span>&nbsp;
                            <span class="button__text">Linting your Rust code with Clippy</span>
                        </a>
                    </span>
                
                
                    <span class="button next">
                        <a href="https://rsbit.es/upload-file-to-s3/">
                            <span class="button__text">Using rusoto to upload a file to S3</span>&nbsp;
                            <span class="button__icon">‚Üí</span>
                        </a>
                    </span>
                </div>
        </div>
    
    </div>

    </div>

    
    <footer class="footer">
        <div class="footer__inner">
                <div class="copyright">
                        <span>¬© 
    2025
 Bob Belderbos</span>
                    <span class="copyright-theme">
                        <span class="copyright-theme-sep">:: </span>
                        Theme: <a href="https://github.com/pawroman/zola-theme-terminimal/">Terminimal</a> by pawroman
                    </span>
                </div>
            </div>
    </footer>
    

</div>
</body>

</html>
