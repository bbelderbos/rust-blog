<!DOCTYPE html>
<html lang="en">

<head>
    <title>How to handle environment variables in Rust | Bite‚Äësized Rust learning, powered by Pybites</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="robots" content="noodp"/>

    <link rel="stylesheet" href="https://rsbit.es/style.css">
    <link rel="stylesheet" href="https://rsbit.es/color/blue.css">

    <link rel="stylesheet" href="https://rsbit.es/font-hack-subset.css">

    <meta name="description" content="">

    <meta property="og:description" content="">
    <meta property="og:title" content="How to handle environment variables in Rust | Bite‚Äësized Rust learning, powered by Pybites">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://rsbit.es/environment-variables-rust/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="">
    <meta name="twitter:title" content="How to handle environment variables in Rust | Bite‚Äësized Rust learning, powered by Pybites">
    <meta property="twitter:domain" content="rsbit.es">
    <meta property="twitter:url" content="https://rsbit.es/environment-variables-rust/">

            
        <link rel="alternate" type="application/atom+xml" title="RSS" href="https://rsbit.es/atom.xml">
    
    </head>

<body class="">
<div class="container">
    
    <header class="header">
        <div class="header__inner">
            <div class="header__logo">
                    
                <a href="/" style="text-decoration: none;">
                    <div class="logo">
                      
                            Bite-sized Rust
                        
                    </div>
                </a>
            </div>
        </div>

        
        
                <nav class="menu">
            <ul class="menu__inner">
                <li class="active"><a href="https://rsbit.es">Home</a></li>
            
                <li><a href="https://rsbit.es/pages/archive">Archive</a></li>
            
                <li><a href="https://rustplatform.com" target="_blank" rel="noopener noreferrer">Excercises</a></li>
            
                <li><a href="https://rsbit.es/pages/search">Search</a></li>
            
                <li><a href="https://rsbit.es/pages/about">About</a></li>
            
                <li><a href="https://github.com/bbelderbos" target="_blank" rel="noopener noreferrer">GitHub</a></li>
            </ul>
        </nav>
    
    
        
    </header>
    

    <div class="content">
        
    <div class="post">
        
    <h1 class="post-title"><a href="https://rsbit.es/environment-variables-rust/">How to handle environment variables in Rust</a></h1>
    <div class="post-meta-inline">
        
    <span class="post-date">
            2024-06-13
        </span>

    </div>

    

        <div class="post-content">
            <p>In this article, I will share how to isolate your environment variables from production code using the <code>dotenv</code> crate in Rust.</p>
<h2 id="why-is-this-important-thinking">Why is this important? ü§î</h2>
<p>As we can read in The Twelve-Factor App / III. Config section you want to separate config from code:</p>
<blockquote>
<p>Apps sometimes store config as constants in the code. This is a violation of twelve-factor, which requires strict separation of config from code.</p>
</blockquote>
<p>See <a href="https://12factor.net/config">The twelve-factor app - III. Config</a> for more details.</p>
<p>Basically, you want to be able to make config changes independently from code changes. üí°</p>
<p>We also want to hide secret keys and API credentials! Notice that git is very persistent (see <a href="https://www.youtube.com/watch?v=2uaTPmNvH0I">this PyCon talk</a> for example) so it‚Äôs important to get this right from the start.</p>
<h2 id="loading-environment-variables-in-rust">Loading environment variables in Rust</h2>
<p>You can load in environment variables like this in Rust:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">use </span><span>std::env;
</span><span>
</span><span style="color:#b48ead;">let</span><span> my_var = env::var(&quot;</span><span style="color:#a3be8c;">MY_VAR</span><span>&quot;).</span><span style="color:#96b5b4;">expect</span><span>(&quot;</span><span style="color:#a3be8c;">MY_VAR must be set</span><span>&quot;);
</span></code></pre>
<p>But that requires you to set the environment variables before running your program (<code>export MY_VAR=my_value</code> from the command line). This is not ideal for production code and even for local development, it can be cumbersome.</p>
<p>It's common to keep a local <code>.env</code> file with your environment variables (don't forget to add this file to your <code>.gitignore</code>!)</p>
<h2 id="using-the-dotenv-crate-chart-with-upwards-trend">Using the <code>dotenv</code> crate üìà</h2>
<p>Researching how you can do this in Rust, I stumbled upon the <code>dotenv</code> crate, which makes handling environment variables straightforward.</p>
<p>First, add the crate to your <code>Cargo.toml</code>:</p>
<pre data-lang="toml" style="background-color:#2b303b;color:#c0c5ce;" class="language-toml "><code class="language-toml" data-lang="toml"><span>[dependencies]
</span><span style="color:#bf616a;">dotenv </span><span>= &quot;</span><span style="color:#a3be8c;">0.15.0</span><span>&quot;
</span></code></pre>
<p>Secondly, you create an <code>.env</code> file in the root of your project:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">MY_VAR</span><span>=</span><span style="color:#a3be8c;">my_value
</span></code></pre>
<p>Again it‚Äôs important that you ignore this file with git, otherwise, you might end up committing sensitive data to your repo/project. üò±</p>
<h2 id="ignoring-env-in-git">Ignoring <code>.env</code> in git</h2>
<p>Not sure what the Rust standard is, a <a href="https://github.com/github/gitignore/blob/main/Rust.gitignore">standard Rust .gitignore file</a> does not include the <code>.env</code> pattern, <a href="https://github.com/github/gitignore/blob/main/Python.gitignore">Python's one</a> does.</p>
<p>What I usually do (in Python) is commit an empty <code>.env-example</code> (or <code>.env-template</code>) file so other developers know what they should set.</p>
<p>So a new developer (or me checking out the repo on another machine) can do a <code>cp .env-template .env</code> and populate the variables. As the (checked out) <code>.gitignore</code> file contains <code>.env</code>, git won‚Äôt show it as a file to be staged for commit.</p>
<h2 id="example-using-dotenv">Example using <code>dotenv</code></h2>
<p>To load in the variables from this file, we use a few lines of code:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">extern crate</span><span> dotenv;
</span><span style="color:#b48ead;">use </span><span>dotenv::dotenv;
</span><span style="color:#b48ead;">use </span><span>std::env;
</span><span>
</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">main</span><span>() {
</span><span>    </span><span style="color:#96b5b4;">dotenv</span><span>().</span><span style="color:#96b5b4;">ok</span><span>();
</span><span>
</span><span>    </span><span style="color:#b48ead;">let</span><span> background_img = env::var(&quot;</span><span style="color:#a3be8c;">THUMB_BACKGROUND_IMAGE</span><span>&quot;).</span><span style="color:#96b5b4;">expect</span><span>(&quot;</span><span style="color:#a3be8c;">THUMB_BACKGROUND_IMAGE must be set</span><span>&quot;);
</span><span>    </span><span style="color:#b48ead;">let</span><span> font_file = env::var(&quot;</span><span style="color:#a3be8c;">THUMB_FONT_TTF_FILE</span><span>&quot;).</span><span style="color:#96b5b4;">expect</span><span>(&quot;</span><span style="color:#a3be8c;">THUMB_FONT_TTF_FILE must be set</span><span>&quot;);
</span><span>
</span><span>    println!(&quot;</span><span style="color:#a3be8c;">Background Image: </span><span style="color:#d08770;">{}</span><span>&quot;, background_img);
</span><span>    println!(&quot;</span><span style="color:#a3be8c;">Font File: </span><span style="color:#d08770;">{}</span><span>&quot;, font_file);
</span><span>}
</span></code></pre>
<ul>
<li><code>dotenv().ok()</code> loads the environment variables from the <code>.env</code> file.</li>
<li><code>.expect</code> is used to handle the case where the environment variable is not set.</li>
</ul>
<p>With this setup, you can now access your environment variables using <code>env::var</code>:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> cargo run</span><span style="color:#bf616a;"> -q
</span><span style="color:#bf616a;">thread </span><span>&#39;</span><span style="color:#a3be8c;">main</span><span>&#39; panicked at src/main.rs:8:61:
</span><span style="color:#bf616a;">THUMB_BACKGROUND_IMAGE</span><span> must be set: NotPresent
</span></code></pre>
<p>This is because we didn't set the environment variables yet in <code>.env</code>, doing so:</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#65737e;"># .env
</span><span style="color:#bf616a;">THUMB_BACKGROUND_IMAGE</span><span>=</span><span style="color:#a3be8c;">some_image.jpg
</span><span style="color:#bf616a;">THUMB_FONT_TTF_FILE</span><span>=</span><span style="color:#a3be8c;">some_font.ttf
</span></code></pre>
<p>Now it works as expected üéâ</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">$</span><span> cargo run</span><span style="color:#bf616a;"> -q
</span><span style="color:#bf616a;">Background</span><span> Image: some_image.jpg
</span><span style="color:#bf616a;">Font</span><span> File: some_font.ttf
</span></code></pre>
<p>This is actually pretty similar to Python using the <code>python-dotenv</code> library. üêç</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>dotenv </span><span style="color:#b48ead;">import </span><span>load_dotenv
</span><span style="color:#b48ead;">import </span><span>os
</span><span>
</span><span style="color:#bf616a;">load_dotenv</span><span>()
</span><span>
</span><span>background_img = os.</span><span style="color:#bf616a;">getenv</span><span>(&quot;</span><span style="color:#a3be8c;">THUMB_BACKGROUND_IMAGE</span><span>&quot;)
</span><span>font_file = os.</span><span style="color:#bf616a;">getenv</span><span>(&quot;</span><span style="color:#a3be8c;">THUMB_FONT_TTF_FILE</span><span>&quot;)
</span></code></pre>
<p>For boolean values, a common requirement for configuration settings like <code>DEBUG</code>, you can use <code>env::var</code> and parse the string to a boolean like this:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">let</span><span> is_debug: </span><span style="color:#b48ead;">bool </span><span>= env::var(&quot;</span><span style="color:#a3be8c;">DEBUG</span><span>&quot;).</span><span style="color:#96b5b4;">map</span><span>(|</span><span style="color:#bf616a;">v</span><span>| v == &quot;</span><span style="color:#a3be8c;">true</span><span>&quot;).</span><span style="color:#96b5b4;">unwrap_or</span><span>(</span><span style="color:#d08770;">false</span><span>);
</span><span>...
</span><span>println!(&quot;</span><span style="color:#a3be8c;">Debug: </span><span style="color:#d08770;">{}</span><span>&quot;, is_debug);
</span></code></pre>
<ul>
<li>This works when setting <code>DEBUG=true</code> or <code>DEBUG=false</code> in your <code>.env</code> file.</li>
<li><code>.map</code> is used to convert the string to a boolean.</li>
<li>The final <code>unwrap_or</code> is used to handle the case where the environment variable is not set or contains an invalid value.</li>
</ul>
<h2 id="practice-this">Practice This</h2>
<p>The <code>.map</code> and <code>.unwrap_or</code> patterns used in this post are core to working with <code>Option</code> in Rust. Practice them on the Pybites Rust Platform:</p>
<ul>
<li><a href="https://rustplatform.com/option-handling">Option Handling</a></li>
<li><a href="https://rustplatform.com/option-combinators">Option Combinators</a></li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>Handling environment variables in Rust is straightforward using the <code>dotenv</code> crate. This approach keeps your configuration separate from your code, making it easier to manage and secure.</p>
<p>I hope this article helps you to keep your environment variables safe and secure. üõ°Ô∏è</p>
<p>Happy coding! ü¶Ä</p>
<p><em>This article is an adaption from our Python article: <a href="https://pybit.es/articles/how-to-handle-environment-variables-in-python/">How to handle environment variables in Python</a>.</em></p>

        </div>

        
        <div class="pagination">
            <div class="pagination__title">
                <span class="pagination__title-h">Thanks for reading! Reach out to me on X | Fosstodon | LinkedIn: @bbelderbos</span>
                <hr />
            </div>
            <div class="pagination__buttons">
                    <span class="button previous">
                        <a href="https://rsbit.es/convert-markdown-to-html-script/">
                            <span class="button__icon">‚Üê</span>&nbsp;
                            <span class="button__text">Converting markdown files to HTML in Rust</span>
                        </a>
                    </span>
                
                
                    <span class="button next">
                        <a href="https://rsbit.es/building-website-axum/">
                            <span class="button__text">I built my first Rust website using Axum</span>&nbsp;
                            <span class="button__icon">‚Üí</span>
                        </a>
                    </span>
                </div>
        </div>
    
    </div>

    </div>

    
    <footer class="footer">
        <div class="footer__inner">
                <div class="copyright">
                        <span>¬© 
    2026
 Bob Belderbos</span>
                    <span class="copyright-theme">
                        <span class="copyright-theme-sep">:: </span>
                        Theme: <a href="https://github.com/pawroman/zola-theme-terminimal/">Terminimal</a> by pawroman
                    </span>
                </div>
            </div>
    </footer>
    

</div>
</body>

</html>
