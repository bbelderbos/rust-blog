<!DOCTYPE html>
<html lang="en">

<head>
    <title>How to write unit tests in Rust | Bite‑sized Rust learning, powered by Pybites</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="robots" content="noodp"/>

    <link rel="stylesheet" href="https://rsbit.es/style.css">
    <link rel="stylesheet" href="https://rsbit.es/color/blue.css">

    <link rel="stylesheet" href="https://rsbit.es/font-hack-subset.css">

    <meta name="description" content="">

    <meta property="og:description" content="">
    <meta property="og:title" content="How to write unit tests in Rust | Bite‑sized Rust learning, powered by Pybites">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://rsbit.es/testing-in-rust/">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="">
    <meta name="twitter:title" content="How to write unit tests in Rust | Bite‑sized Rust learning, powered by Pybites">
    <meta property="twitter:domain" content="rsbit.es">
    <meta property="twitter:url" content="https://rsbit.es/testing-in-rust/">

            
        <link rel="alternate" type="application/atom+xml" title="RSS" href="https://rsbit.es/atom.xml">
    
    </head>

<body class="">
<div class="container">
    
    <header class="header">
        <div class="header__inner">
            <div class="header__logo">
                    
                <a href="/" style="text-decoration: none;">
                    <div class="logo">
                      
                            Bite-sized Rust
                        
                    </div>
                </a>
            </div>
        </div>

        
        
                <nav class="menu">
            <ul class="menu__inner">
                <li class="active"><a href="https://rsbit.es">Home</a></li>
            
                <li><a href="https://rsbit.es/pages/archive">Archive</a></li>
            
                <li><a href="https://rustplatform.com" target="_blank" rel="noopener noreferrer">Excercises</a></li>
            
                <li><a href="https://rsbit.es/pages/search">Search</a></li>
            
                <li><a href="https://rsbit.es/pages/about">About</a></li>
            
                <li><a href="https://github.com/bbelderbos" target="_blank" rel="noopener noreferrer">GitHub</a></li>
            </ul>
        </nav>
    
    
        
    </header>
    

    <div class="content">
        
    <div class="post">
        
    <h1 class="post-title"><a href="https://rsbit.es/testing-in-rust/">How to write unit tests in Rust</a></h1>
    <div class="post-meta-inline">
        
    <span class="post-date">
            2024-07-03
        </span>

    </div>

    

        <div class="post-content">
            <p>In Python you can use <code>unittest</code> (Standard Library) or <code>pytest</code> (PyPI) to write tests. In Rust, you can use the <code>#[cfg(test)]</code> and <code>#[test]</code> attributes to write tests. Let's explore how ...</p>
<h2 id="writing-a-test">Writing a test</h2>
<p>To get some boilerplace code, make a library project with <code>cargo new mylib --lib</code> and you get this:</p>
<pre data-lang="shell" style="background-color:#2b303b;color:#c0c5ce;" class="language-shell "><code class="language-shell" data-lang="shell"><span>√ rust  $ cargo new --lib testproject
</span><span>    Creating library `testproject` package
</span><span>note: see more `Cargo.toml` keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html
</span><span>√ rust  $ cat testproject/src/lib.rs
</span><span>pub fn add(left: usize, right: usize) -&gt; usize {
</span><span>    left + right
</span><span>}
</span><span>
</span><span>#[cfg(test)]
</span><span>mod tests {
</span><span>    use super::*;
</span><span>
</span><span>    #[test]
</span><span>    fn it_works() {
</span><span>        let result = add(2, 2);
</span><span>        assert_eq!(result, 4);
</span><span>    }
</span><span>}
</span></code></pre>
<ul>
<li>
<p><code>#[cfg(test)]</code> is a conditional compilation attribute that tells the compiler to only compile the module when running tests.</p>
</li>
<li>
<p><code>mod tests</code> is a module that contains all the tests.</p>
</li>
<li>
<p><code>use super::*;</code> imports all the functions from the parent module.</p>
</li>
<li>
<p><code>#[test]</code> is an attribute that tells the compiler that the function is a test, you prepend it to each test function.</p>
</li>
<li>
<p><code>assert_eq!</code> is a macro that checks if the two arguments are equal.</p>
</li>
</ul>
<p>That's it. Now you can run <code>cargo test</code> to run the tests. If you want to run a specific test, you can run <code>cargo test it_works</code> (similar to <code>pytest -k</code>).</p>
<h2 id="writing-some-tests-for-my-cli-alarm-project">Writing some tests for my CLI alarm project</h2>
<p>This both a good and bad project to demo this. Bad because it uses system audio which is hard to test. Good because it's a simple project and has one function I am interested in testing for this article.</p>
<p>Here is the code:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>...
</span><span>...
</span><span style="color:#b48ead;">pub fn </span><span style="color:#8fa1b3;">humanize_duration</span><span>(</span><span style="color:#bf616a;">duration</span><span>: Duration) -&gt; String {
</span><span>    </span><span style="color:#b48ead;">let</span><span> secs = duration.</span><span style="color:#96b5b4;">as_secs</span><span>();
</span><span>    </span><span style="color:#b48ead;">if</span><span> secs &lt; </span><span style="color:#d08770;">60 </span><span>{
</span><span>        format!(&quot;</span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;"> second</span><span style="color:#d08770;">{}</span><span>&quot;, secs, </span><span style="color:#b48ead;">if</span><span> secs == </span><span style="color:#d08770;">1 </span><span>{ &quot;&quot; } </span><span style="color:#b48ead;">else </span><span>{ &quot;</span><span style="color:#a3be8c;">s</span><span>&quot; })
</span><span>    } </span><span style="color:#b48ead;">else </span><span>{
</span><span>        </span><span style="color:#b48ead;">let</span><span> mins = secs / </span><span style="color:#d08770;">60</span><span>;
</span><span>        </span><span style="color:#b48ead;">let</span><span> remaining_secs = secs % </span><span style="color:#d08770;">60</span><span>;
</span><span>        </span><span style="color:#b48ead;">if</span><span> remaining_secs &gt; </span><span style="color:#d08770;">0 </span><span>{
</span><span>            format!(
</span><span>                &quot;</span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;"> minute</span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;"> and </span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;"> second</span><span style="color:#d08770;">{}</span><span>&quot;,
</span><span>                mins,
</span><span>                </span><span style="color:#b48ead;">if</span><span> mins == </span><span style="color:#d08770;">1 </span><span>{ &quot;&quot; } </span><span style="color:#b48ead;">else </span><span>{ &quot;</span><span style="color:#a3be8c;">s</span><span>&quot; },
</span><span>                remaining_secs,
</span><span>                </span><span style="color:#b48ead;">if</span><span> remaining_secs == </span><span style="color:#d08770;">1 </span><span>{ &quot;&quot; } </span><span style="color:#b48ead;">else </span><span>{ &quot;</span><span style="color:#a3be8c;">s</span><span>&quot; }
</span><span>            )
</span><span>        } </span><span style="color:#b48ead;">else </span><span>{
</span><span>            format!(&quot;</span><span style="color:#d08770;">{}</span><span style="color:#a3be8c;"> minute</span><span style="color:#d08770;">{}</span><span>&quot;, mins, </span><span style="color:#b48ead;">if</span><span> mins == </span><span style="color:#d08770;">1 </span><span>{ &quot;&quot; } </span><span style="color:#b48ead;">else </span><span>{ &quot;</span><span style="color:#a3be8c;">s</span><span>&quot; })
</span><span>        }
</span><span>    }
</span><span>}
</span><span>...
</span><span>...
</span></code></pre>
<p>Copying above boilerplace over I got to write these tests:</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>#[</span><span style="color:#bf616a;">cfg</span><span>(test)]
</span><span style="color:#b48ead;">mod </span><span>tests {
</span><span>    </span><span style="color:#b48ead;">use super</span><span>::*;
</span><span>    </span><span style="color:#b48ead;">use </span><span>std::time::Duration;
</span><span>
</span><span>    #[</span><span style="color:#bf616a;">test</span><span>]
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">test_short_durations</span><span>() {
</span><span>        assert_eq!(</span><span style="color:#96b5b4;">humanize_duration</span><span>(Duration::from_secs(</span><span style="color:#d08770;">0</span><span>)), &quot;</span><span style="color:#a3be8c;">0 seconds</span><span>&quot;);
</span><span>        assert_eq!(</span><span style="color:#96b5b4;">humanize_duration</span><span>(Duration::from_secs(</span><span style="color:#d08770;">1</span><span>)), &quot;</span><span style="color:#a3be8c;">1 second</span><span>&quot;);
</span><span>        assert_eq!(</span><span style="color:#96b5b4;">humanize_duration</span><span>(Duration::from_secs(</span><span style="color:#d08770;">30</span><span>)), &quot;</span><span style="color:#a3be8c;">30 seconds</span><span>&quot;);
</span><span>    }
</span><span>
</span><span>    #[</span><span style="color:#bf616a;">test</span><span>]
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">test_exact_minute_durations</span><span>() {
</span><span>        assert_eq!(</span><span style="color:#96b5b4;">humanize_duration</span><span>(Duration::from_secs(</span><span style="color:#d08770;">60</span><span>)), &quot;</span><span style="color:#a3be8c;">1 minute</span><span>&quot;);
</span><span>        assert_eq!(</span><span style="color:#96b5b4;">humanize_duration</span><span>(Duration::from_secs(</span><span style="color:#d08770;">180</span><span>)), &quot;</span><span style="color:#a3be8c;">3 minutes</span><span>&quot;);
</span><span>        assert_eq!(</span><span style="color:#96b5b4;">humanize_duration</span><span>(Duration::from_secs(</span><span style="color:#d08770;">3600</span><span>)), &quot;</span><span style="color:#a3be8c;">60 minutes</span><span>&quot;);
</span><span>    }
</span><span>
</span><span>    #[</span><span style="color:#bf616a;">test</span><span>]
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">test_minute_and_second_durations</span><span>() {
</span><span>        assert_eq!(
</span><span>            </span><span style="color:#96b5b4;">humanize_duration</span><span>(Duration::from_secs(</span><span style="color:#d08770;">61</span><span>)),
</span><span>            &quot;</span><span style="color:#a3be8c;">1 minute and 1 second</span><span>&quot;
</span><span>        );
</span><span>        assert_eq!(
</span><span>            </span><span style="color:#96b5b4;">humanize_duration</span><span>(Duration::from_secs(</span><span style="color:#d08770;">122</span><span>)),
</span><span>            &quot;</span><span style="color:#a3be8c;">2 minutes and 2 seconds</span><span>&quot;
</span><span>        );
</span><span>        assert_eq!(
</span><span>            </span><span style="color:#96b5b4;">humanize_duration</span><span>(Duration::from_secs(</span><span style="color:#d08770;">333</span><span>)),
</span><span>            &quot;</span><span style="color:#a3be8c;">5 minutes and 33 seconds</span><span>&quot;
</span><span>        );
</span><span>    }
</span><span>
</span><span>    #[</span><span style="color:#bf616a;">test</span><span>]
</span><span>    </span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">test_edge_cases</span><span>() {
</span><span>        assert_eq!(</span><span style="color:#96b5b4;">humanize_duration</span><span>(Duration::from_secs(</span><span style="color:#d08770;">59</span><span>)), &quot;</span><span style="color:#a3be8c;">59 seconds</span><span>&quot;);
</span><span>        assert_eq!(
</span><span>            </span><span style="color:#96b5b4;">humanize_duration</span><span>(Duration::from_secs(</span><span style="color:#d08770;">119</span><span>)),
</span><span>            &quot;</span><span style="color:#a3be8c;">1 minute and 59 seconds</span><span>&quot;
</span><span>        );
</span><span>        assert_eq!(
</span><span>            </span><span style="color:#96b5b4;">humanize_duration</span><span>(Duration::from_secs(</span><span style="color:#d08770;">3599</span><span>)),
</span><span>            &quot;</span><span style="color:#a3be8c;">59 minutes and 59 seconds</span><span>&quot;
</span><span>        );
</span><span>    }
</span><span>}
</span></code></pre>
<p>I could have grouped them all into one test, but I wanted:</p>
<ul>
<li>To show how you can write multiple tests.</li>
<li>To have better naming for each test for readability and targeting.</li>
</ul>
<p>On the other hand having a test function for each test would be way too verbose.</p>
<p>Unfortunately there is no <code>parametrize</code> feature in Rust like in pytest, so this was my &quot;workaround&quot; for now.</p>
<p>Running <code>cargo test</code> I get:</p>
<pre data-lang="shell" style="background-color:#2b303b;color:#c0c5ce;" class="language-shell "><code class="language-shell" data-lang="shell"><span>$ cargo test
</span><span>...
</span><span>running 4 tests
</span><span>test tests::test_minute_and_second_durations ... ok
</span><span>test tests::test_edge_cases ... ok
</span><span>test tests::test_exact_minute_durations ... ok
</span><span>test tests::test_short_durations ... ok
</span><span>
</span><span>test result: ok. 4 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s
</span><span>
</span><span>$ cargo test edge_ca
</span><span>...
</span><span>running 1 test
</span><span>test tests::test_edge_cases ... ok
</span><span>
</span><span>test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 3 filtered out; finished in 0.00s
</span></code></pre>
<h2 id="unittest-vs-integration-tests">Unittest vs integration tests</h2>
<p>This has been an example of a unit test: a test that tests a single piece of code, often a single function.</p>
<p>You can also write integration tests in Rust. Integration tests are tests that test the interaction between multiple modules or components.</p>
<p>You can write integration tests in a <code>tests</code> directory, I will show here when I cross that bridge ...</p>
<h2 id="conclusion">Conclusion</h2>
<p>The <code>#[cfg(test)]</code> attribute is a conditional compilation attribute that instructs the Rust compiler to only compile the annotated module when running tests.</p>
<p>Within this module, the <code>#[test]</code> attribute is used to mark functions as tests, and the <code>assert_eq!</code> macro is employed to check if two values are equal.</p>
<p>It is common practice to bundle unit tests within the same module as the code being tested. Integration tests, however, are typically placed in a dedicated module within the <code>tests</code> directory.</p>
<p>Rust does not have a built-in <code>parametrize</code> feature like pytest. To manage multiple test cases, you can either write individual test functions for each case or group similar tests within a few functions to improve naming and targeting options.</p>

        </div>

        
        <div class="pagination">
            <div class="pagination__title">
                <span class="pagination__title-h">Thanks for reading! Reach out to me on X | Fosstodon | LinkedIn: @bbelderbos</span>
                <hr />
            </div>
            <div class="pagination__buttons">
                    <span class="button previous">
                        <a href="https://rsbit.es/from-script-to-library-in-rust/">
                            <span class="button__icon">←</span>&nbsp;
                            <span class="button__text">From script to library in Rust</span>
                        </a>
                    </span>
                
                
                    <span class="button next">
                        <a href="https://rsbit.es/automating-test-runs-and-checking-coverage/">
                            <span class="button__text">Automating test runs and checking coverage</span>&nbsp;
                            <span class="button__icon">→</span>
                        </a>
                    </span>
                </div>
        </div>
    
    </div>

    </div>

    
    <footer class="footer">
        <div class="footer__inner">
                <div class="copyright">
                        <span>© 
    2026
 Bob Belderbos</span>
                    <span class="copyright-theme">
                        <span class="copyright-theme-sep">:: </span>
                        Theme: <a href="https://github.com/pawroman/zola-theme-terminimal/">Terminimal</a> by pawroman
                    </span>
                </div>
            </div>
    </footer>
    

</div>
</body>

</html>
